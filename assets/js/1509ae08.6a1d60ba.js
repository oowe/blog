"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[5092],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),m=s(n),d=o,y=m["".concat(c,".").concat(d)]||m[d]||u[d]||a;return n?r.createElement(y,l(l({ref:t},p),{},{components:n})):r.createElement(y,l({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=m;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var s=2;s<a;s++)l[s]=n[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9779:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return i},metadata:function(){return s},toc:function(){return p}});var r=n(7462),o=n(3366),a=(n(7294),n(3905)),l=["components"],i={},c="TypeORM",s={unversionedId:"NestJS/typeorm",id:"NestJS/typeorm",isDocsHomePage:!1,title:"TypeORM",description:"Install TypeORM",source:"@site/docs/NestJS/typeorm.md",sourceDirName:"NestJS",slug:"/NestJS/typeorm",permalink:"/blog/docs/NestJS/typeorm",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/NestJS/typeorm.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Task Schedule",permalink:"/blog/docs/NestJS/task-schedule"},next:{title:"Command",permalink:"/blog/docs/NodeJS/command"}},p=[{value:"Install TypeORM",id:"install-typeorm",children:[]},{value:"Create connect to DB",id:"create-connect-to-db",children:[]},{value:"<strong>Module \u6709\u4f7f\u7528\u5230 entity \u5c31\u8981 import</strong>",id:"module-\u6709\u4f7f\u7528\u5230-entity-\u5c31\u8981-import",children:[{value:"import \u7684\u65b9\u6cd5",id:"import-\u7684\u65b9\u6cd5",children:[]},{value:"createQueryBuilder \u7bc4\u4f8b",id:"createquerybuilder-\u7bc4\u4f8b",children:[]},{value:"\u6307\u4ee4\u64cd\u4f5c",id:"\u6307\u4ee4\u64cd\u4f5c",children:[]},{value:"string[]\u7684\u65b9\u6cd5",id:"string\u7684\u65b9\u6cd5",children:[]}]}],u={toc:p};function m(e){var t=e.components,n=(0,o.Z)(e,l);return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"typeorm"},"TypeORM"),(0,a.kt)("h3",{id:"install-typeorm"},"Install TypeORM"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm install --save @nestjs/typeorm typeorm mysql2\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"typescript \u578b\u5225\u5c0d\u61c9\u5230\u8cc7\u6599\u5eab\u578b\u5225"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"number -> integer"),(0,a.kt)("li",{parentName:"ul"},"string -> varchar"),(0,a.kt)("li",{parentName:"ul"},"boolean -> bool"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u88dd\u98fe\u5668"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"@Entity({name: 'school'}) \u5be6\u9ad4\u5316 table",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u9ed8\u8a8d\u4ee5 name \u53c3\u6578\u7232 table name\uff0c\u82e5\u7121\u5247\u7528 class name"),(0,a.kt)("li",{parentName:"ul"},"\u540d\u7a31\u547d\u547d\u540d\u7232\u99dd\u5cf0\u5f0f\u6703\u4ee5\u4e0b\u5e95\u7dda\u9694\u958b\uff08\u9ed8\u8a8d\uff09"),(0,a.kt)("li",{parentName:"ul"},"table name \u90fd\u662f\u5c0f\u5beb"))),(0,a.kt)("li",{parentName:"ul"},"@Column() \u5be6\u9ad4\u5316\u5c6c\u6027"),(0,a.kt)("li",{parentName:"ul"},"@PrimaryColumn():\u4e3b\u9375"),(0,a.kt)("li",{parentName:"ul"},"@PrimaryGeneratedColumn():\u66f4\u65b9\u4fbf\u7684\u4e3b\u9375",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u5047\u8bbe\u4f60\u5e0c\u671b id \u5217\u81ea\u52a8\u751f\u6210\uff0c\u4f60\u9700\u8981\u5c06@PrimaryColumn \u88c5\u9970\u5668\u66f4\u6539\u4e3a@PrimaryGeneratedColumn \u88c5\u9970\u5668"))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"new table exmple"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Entity, Column } from \"typeorm\";\n\n@Entity({name: 'Photo'})\nexport class Photo {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column({\n    length: 100\n  })\n  name: string;\n\n  @Column(\"text\")\n  description: string;\n\n  @Column(\"double\")\n  view: number;\n\n  @CreateDateColumn({\n    type: 'datetime'\n  })\n  created: Date;\n\n  @UpdateDateColumn({\n    type: 'datetime'\n  })\n  updated: Date;\n")),(0,a.kt)("h3",{id:"create-connect-to-db"},"Create connect to DB"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},"@Module({\n  imports: [TypeOrmModule.forRoot({\n    type: 'mysql',\n    host: 'localhost',\n    port: {port},\n    username: '{username}',\n    password: '{username}',\n    database: '{dbname}',\n    entities: [SchoolEntity],\n    synchronize: true,\n  }), SchoolModule\n]\n")),(0,a.kt)("h2",{id:"module-\u6709\u4f7f\u7528\u5230-entity-\u5c31\u8981-import"},(0,a.kt)("strong",{parentName:"h2"},"[Module \u6709\u4f7f\u7528\u5230 entity \u5c31\u8981 import]")),(0,a.kt)("h3",{id:"import-\u7684\u65b9\u6cd5"},"import \u7684\u65b9\u6cd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript="},"import { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { SchoolEntity } from 'src/entities/school.entity';\nimport { SchoolController } from './school.controller';\nimport { SchoolService } from './school.service';\n\n@Module({\n  imports: [TypeOrmModule.forFeature([SchoolEntity])],\n  controllers: [SchoolController],\n  providers: [SchoolService]\n})\nexport class SchoolModule {}\n")),(0,a.kt)("h3",{id:"createquerybuilder-\u7bc4\u4f8b"},"createQueryBuilder \u7bc4\u4f8b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript="},'        try {\n            const obj: SchoolEntity[] = await this.schoolRepository.createQueryBuilder()\n                .select()\n                .where("name = :name", { name: "cat"})\n                .getMany();\n            return (obj) ? obj : {};\n        } catch (err) {\n            console.log(err);\n            return err;\n        }\n    }\n')),(0,a.kt)("h3",{id:"\u6307\u4ee4\u64cd\u4f5c"},"\u6307\u4ee4\u64cd\u4f5c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'//\u522a\u9664\u5168\u90e8table\u8cc7\u6599\nawait this.scensScheduleRepository.clear();\n\n//\u522a\u9664\u7279\u5b9a\u8cc7\u6599\nconst condition = { headerMode: "schedule" };\nawait this.scensScheduleRepository.delete(condition);\n\n//\u6e05\u7a7a\u8cc7\u6599\u8868\n//method1\nawait this.scensScheduleRepository.clear();\n//method2\nconst repository = await this.scensScheduleRepository;\nawait repository.query(`TRUNCATE TABLE \\`${"scense_schedule"}\\`;`);\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'async removeAll(): Promise<string> {\ntry {\nawait this.scensScheduleRepository.clear();\n\n    } catch (error) {\n      throw new Error(`ERROR: Cleaning test db: ${error}`);\n      return "`ERROR: Cleaning test db: ${error}`";\n    }\n    return "Done";\n\n}\n}\n\nthrow new HttpException(\'Forbidden\', HttpStatus.FORBIDDEN);\n')),(0,a.kt)("h3",{id:"string\u7684\u65b9\u6cd5"},"string[]\u7684\u65b9\u6cd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-tsx"},'@Entity()\nexport class User {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column("simple-array")\n  names: string[];\n}\n')))}m.isMDXComponent=!0}}]);