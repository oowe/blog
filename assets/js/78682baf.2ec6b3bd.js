"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[6672],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var l=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,l,a=function(e,t){if(null==e)return{};var n,l,a={},r=Object.keys(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)n=r[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=l.createContext({}),p=function(e){var t=l.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return l.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},m=l.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,k=m["".concat(s,".").concat(d)]||m[d]||c[d]||r;return n?l.createElement(k,i(i({ref:t},u),{},{components:n})):l.createElement(k,i({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var p=2;p<r;p++)i[p]=n[p];return l.createElement.apply(null,i)}return l.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4623:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return u}});var l=n(7462),a=n(3366),r=(n(7294),n(3905)),i=["components"],o={sidebar_position:1},s="Command",p={unversionedId:"NestJS/command",id:"NestJS/command",isDocsHomePage:!1,title:"Command",description:"Reference from https://dev.to/santypk4/bulletproof-node-js-project-architecture-4epf",source:"@site/docs/NestJS/command.md",sourceDirName:"NestJS",slug:"/NestJS/command",permalink:"/blog/docs/NestJS/command",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/NestJS/command.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Root Login Problem",permalink:"/blog/docs/MySQL/root-login-problem"},next:{title:"Async and Await",permalink:"/blog/docs/NestJS/async-await"}},u=[{value:"\u597d\u7528\u5de5\u5177",id:"\u597d\u7528\u5de5\u5177",children:[]},{value:"nest \u6307\u4ee4",id:"nest-\u6307\u4ee4",children:[]},{value:"\u4e09\u5c64\u67b6\u69cb",id:"\u4e09\u5c64\u67b6\u69cb",children:[]},{value:"\u64cd\u4f5c",id:"\u64cd\u4f5c",children:[]},{value:"Difference between &#39;npm i --save&#39; and &#39;npm i --save-dev&#39;",id:"difference-between-npm-i---save-and-npm-i---save-dev",children:[]},{value:"npm install -g (\u5168\u57df\u5b89\u88dd)",id:"npm-install--g-\u5168\u57df\u5b89\u88dd",children:[]},{value:"npm init",id:"npm-init",children:[]},{value:"npm install \u53ca package.json \u7684\u7528\u9014",id:"npm-install-\u53ca-packagejson-\u7684\u7528\u9014",children:[]},{value:"package-lock.json \u7684\u7528\u9014",id:"package-lockjson-\u7684\u7528\u9014",children:[]},{value:"Module, Controller and Service",id:"module-controller-and-service",children:[]},{value:"Defult script in package.json",id:"defult-script-in-packagejson",children:[]},{value:"npm build",id:"npm-build",children:[]},{value:".spec.ts \u6a94\u6848",id:"spects-\u6a94\u6848",children:[]},{value:"linux \u6307\u4ee4",id:"linux-\u6307\u4ee4",children:[]},{value:"\u5efa\u7acb module",id:"\u5efa\u7acb-module",children:[]},{value:"Problem \uff08\u5e38\u767c\u751f\u7684\u554f\u984c)",id:"problem-\u5e38\u767c\u751f\u7684\u554f\u984c",children:[]},{value:"File upload",id:"file-upload",children:[]},{value:"\u5c07 file \u7684\u503c\u8b80\u51fa\u4f86",id:"\u5c07-file-\u7684\u503c\u8b80\u51fa\u4f86",children:[]},{value:"@Entity \u7d00\u9304",id:"entity-\u7d00\u9304",children:[]},{value:"\u6a94\u6848\u547d\u540d\u898f\u5247",id:"\u6a94\u6848\u547d\u540d\u898f\u5247",children:[]},{value:"Import service",id:"import-service",children:[]},{value:"Nestjs \u6982\u5ff5",id:"nestjs-\u6982\u5ff5",children:[]},{value:"\u7a0b\u5f0f\u9032\u5165\u9ede(main.ts)",id:"\u7a0b\u5f0f\u9032\u5165\u9edemaints",children:[]},{value:"\u91cd\u8dd1 migrations \u7684\u65b9\u6cd5",id:"\u91cd\u8dd1-migrations-\u7684\u65b9\u6cd5",children:[]},{value:"Class-validator",id:"class-validator",children:[]},{value:"\u76ee\u7684",id:"\u76ee\u7684",children:[]},{value:"Install class-validator",id:"install-class-validator",children:[]}],c={toc:u};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,l.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"command"},"Command"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Reference from ",(0,r.kt)("a",{parentName:"strong",href:"https://dev.to/santypk4/bulletproof-node-js-project-architecture-4epf"},"https://dev.to/santypk4/bulletproof-node-js-project-architecture-4epf"))),(0,r.kt)("h3",{id:"\u597d\u7528\u5de5\u5177"},"\u597d\u7528\u5de5\u5177"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Json formatter (for chrome)")),(0,r.kt)("h3",{id:"nest-\u6307\u4ee4"},"nest \u6307\u4ee4"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5b89\u88dd cli")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"  sudo npm install -g @nestjs/cli\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5efa\u7acb\u5c08\u6848")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"  nest new nest-crash-course\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u904b\u884c\u7a0b\u5f0f")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"  npm run start:dev\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5efa\u7acb")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"  npm i generate\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u6a21\u7d44")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"  nest g mo users\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u63a7\u5236\u5668")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"  nest g co users\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u670d\u52d9")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"  nest g service users\n")),(0,r.kt)("h3",{id:"\u4e09\u5c64\u67b6\u69cb"},"\u4e09\u5c64\u67b6\u69cb"),(0,r.kt)("p",null,"\u53ef\u5206\u6210 Controller, Service Layer, Data Access Layer"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Controller"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8ca0\u8cac\u8def\u7531 get, post, put, delete, patch\uff08RESTful api\uff09"),(0,r.kt)("li",{parentName:"ul"},"\u6b63\u78ba\u8207\u932f\u8aa4\u97ff\u61c9",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"200 success"),(0,r.kt)("li",{parentName:"ul"},"404 not found"),(0,r.kt)("li",{parentName:"ul"},"500 internal server error"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Service Layer"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8ca0\u8cac\u908f\u8f2f"),(0,r.kt)("li",{parentName:"ul"},"\u8207\u8cc7\u6599\u5eab\u6e9d\u901a\u7684 code"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Data Access Layer"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8cc7\u6599\u5eab\u7684\u9023\u7d50\u8207\u5b58\u53d6")))),(0,r.kt)("h3",{id:"\u64cd\u4f5c"},"\u64cd\u4f5c"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5728@Controller('app') \u52a0\u4e0a app",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4ee3\u8868\u5c07\u6240\u6709\u8def\u7531\u704c\u4e0a app \u5b57\u773c"))),(0,r.kt)("li",{parentName:"ul"},"\u5728 nestjs \u5167\u6709\u5f88\u591a\u88dd\u98fe\u5668\uff0c\u53ef\u4ee5\u65b9\u4fbf\u4f7f\u7528"),(0,r.kt)("li",{parentName:"ul"},"\u5728@Get('hello')\u52a0\u4e0a hello",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u4ee3\u8868\u5728 get \u8def\u7531\u8981\u52a0\u4e0a hello \u7684\u524d\u7db4\u624d\u80fd\u8a2a\u554f\u5230"))),(0,r.kt)("li",{parentName:"ul"},"@Module{ imports: ","[users]"," }",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u7576\u4f60\u5efa\u7acb\u4e00\u500b\u65b0\u7684 module \u5b83\u5fc5\u9808\u88ab import \u9032\u4f86\u624d\u80fd\u4f7f\u7528"))),(0,r.kt)("li",{parentName:"ul"},"controller.spec.ts",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"spec.ts \u7d50\u5c3e\u7684\u6a94\u6848\u7528\u5728\u6e2c\u8a66\u4f7f\u7528")))),(0,r.kt)("h3",{id:"difference-between-npm-i---save-and-npm-i---save-dev"},"Difference between 'npm i --save' and 'npm i --save-dev'"),(0,r.kt)("p",null,"dependencies\uff1a\u4f60\u7528\u4e86\u4ec0\u9ebc\u5957\u4ef6 (\u7522\u54c1\u904b\u884c\u8981\u7684\u5957\u4ef6)\ndevDependencies\uff1a\u4f60\u53ea\u6709\u5728\u958b\u767c\u6216\u6e2c\u8a66\u7684\u6642\u5019\u9700\u8981\u7684\u5957\u4ef6 (\u958b\u767c\u6e2c\u8a66\u6642\u5019\u9700\u8981\u7528\u7684)\n\u5728 npm v5.0.0 \u4e4b\u5f8c\uff0c--save \u5df2\u7d93\u6210\u70ba\u9810\u8a2d\u6307\u4ee4\nnpm install -save == npm install"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"npm-install--g-\u5168\u57df\u5b89\u88dd"},"npm install -g (\u5168\u57df\u5b89\u88dd)"),(0,r.kt)("p",null,"\u5982\u679c\u6c92\u6709\u6253-g \u6307\u4ee4\u7684\u8a71\u53ea\u6703\u5b89\u88dd\u5728 node_module \u5167\n\u5982\u679c\u6709\u6253\u7684\u8a71\uff0c\u76f4\u63a5\u5728 terminal \u4e0a\u5c31\u53ef\u4ee5\u57f7\u884c\u6307\u4ee4\nexample: sudo npm install -g jest\n\u4f60\u5728 terminal \u4e0b jest \u5c31\u53ef\u4ee5\u4f7f\u7528\n\u82e5\u8981\u79fb\u9664\u7684\u8a71\u9700\u8981\u4e0b sudo npm uninstall -g jest"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"npm-init"},"npm init"),(0,r.kt)("p",null,"npm init \u57f7\u884c\u7684\u52d5\u4f5c\u5f88\u7c21\u55ae\n\u90a3\u5c31\u53ea\u662f\u5e6b\u6211\u5011\u5275\u5efa package.json \u7684 boilerplate"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"npm-install-\u53ca-packagejson-\u7684\u7528\u9014"},"npm install \u53ca package.json \u7684\u7528\u9014"),(0,r.kt)("p",null,"node_module \u7684\u8a95\u751f\u662f\u56e0\u70ba\uff0c\u76f8\u540c\u5957\u4ef6 for \u4e0d\u540c\u5c08\u6848\uff0c\u6709\u6642\u5f8c\u6709\u4e0d\u80fd\u5171\u7528\u7684\u554f\u984c\n\u512a\u9ede: \u8cc7\u6599\u593e\u7368\u7acb\uff0c\u6a21\u7d44\u7ba1\u7406\u65b9\u4fbf\n\u7f3a\u9ede: \u4f54\u7528\u7a7a\u9593\u591a\n\u57fa\u65bc\u9019\u500b\u7f3a\u9ede\uff0c\u53ea\u9700\u8981\u8907\u88fd\u539f\u59cb\u78bc\u548c package.json\uff0c\u5230\u65b0\u7684\u96fb\u8166\uff0c\u91cd\u65b0 npm install\u3002"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"package-lockjson-\u7684\u7528\u9014"},"package-lock.json \u7684\u7528\u9014"),(0,r.kt)("p",null,"\u4f9d\u7167 package.json \u6240\u5b89\u88dd\u7684\u5957\u4ef6\uff0c\u4e5f\u6703\u5b89\u88dd dependies \u7684\u5957\u4ef6\uff0c\u800c\u9019\u4e9b\u7248\u672c\u865f\u6703\u88ab\u7d00\u9304\u5728 package-lock.json\u3002\n\u66f4\u65b0\u7684\u6307\u4ee4\u5305\u542b npm install / uninstall /update \u90fd\u6703\u53bb\u66f4\u65b0"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"module-controller-and-service"},"Module, Controller and Service"),(0,r.kt)("p",null,"\u5728 nestjs \u5167\uff0c\u4e0d\u540c\u7684\u529f\u80fd\u6703\u5efa\u7acb\u5728\u4e0d\u540c\u7684 Module \u4e0a\n\u6bcf\u500b Module \u6703\u6709\u4e00\u500b Controller \u505a routing \u9019\u4ef6\u4e8b\u60c5\n\u518d\u7528\u4e00\u500b\u6216\u591a\u500b Service \u628a\u8907\u96dc\u7684\u904b\u7b97\u53ca\u529f\u80fd\u5beb\u6210 function"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"defult-script-in-packagejson"},"Defult script in package.json"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"scripts": {\n    "prebuild": "rimraf dist",\n    "build": "nest build",\n    "format": "prettier --write \\"src/**/*.ts\\" \\"test/**/*.ts\\"",\n    "start": "nest start",\n    "start:dev": "nest start --watch",\n    "start:debug": "nest start --debug --watch",\n    "start:prod": "node dist/main",\n    "lint": "eslint \\"{src,apps,libs,test}/**/*.ts\\" --fix",\n    "test": "jest",\n    "test:watch": "jest --watch",\n    "test:cov": "jest --coverage",\n    "test:debug": "node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand",\n    "test:e2e": "jest --config ./test/jest-e2e.json"\n}\n')),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"npm-build"},"npm build"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"=> \u7b49\u65bc nest build\n\u662f\u5c07 dist \u8cc7\u6599\u593e\u5efa\u51fa\u4f86\n")),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"spects-\u6a94\u6848"},".spec.ts \u6a94\u6848"),(0,r.kt)("p",null,".spec \u6216.test \u7d50\u5c3e\u7684\u6a94\u6848\u662f\u7528\u4f86\u505a Jest \u6e2c\u8a66\u4f7f\u7528\u7684\n//\u91dd\u5c0d\u63a7\u5236\u5668\u7684\u55ae\u5143\u6e2c\u8a66"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"linux-\u6307\u4ee4"},"linux \u6307\u4ee4"),(0,r.kt)("p",null,"./ \u7576\u524d\u76ee\u9304\n../ \u4e0a\u4e00\u5c64"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"\u5efa\u7acb-module"},"\u5efa\u7acb module"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"nest g mo users\nnest g co users\nnest g resource users\n")),(0,r.kt)("h3",{id:"problem-\u5e38\u767c\u751f\u7684\u554f\u984c"},"Problem \uff08\u5e38\u767c\u751f\u7684\u554f\u984c)"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Reference from ",(0,r.kt)("a",{parentName:"strong",href:"https://ithelp.ithome.com.tw/articles/10242768"},"https://ithelp.ithome.com.tw/articles/10242768")),"\nNest can't resolve dependencies of the AppController (AppService, ?). Please make sure that the argument StudentService at index ","[1]"," is available in the AppModule context."),(0,r.kt)("p",null,"\u89e3\u6c7a\u65b9\u5f0f: \u901a\u5e38\u662f AppService \u6c92\u6709\u88ab import \u5230 app module \u5167"),(0,r.kt)("h3",{id:"file-upload"},"File upload"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u5b89\u88dd\u5957\u4ef6: npm i -D @types/multer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u8655\u7406\u8cc7\u6599\u683c\u5f0f: multipart/form-data"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Reference from ",(0,r.kt)("a",{parentName:"strong",href:"https://blog.kalan.dev/2021-03-13-html-form-data/"},"https://blog.kalan.dev/2021-03-13-html-form-data/"))),(0,r.kt)("li",{parentName:"ul"},"\u4e00\u822c\u7684 Content-Type \u5f80\u5f80\u53ea\u80fd\u50b3\u9001\u4e00\u7a2e\u5f62\u5f0f\u7684\u8cc7\u6599\uff0c\u4f46\u5728\u7db2\u9801\u7684\u61c9\u7528\u7576\u4e2d\u6211\u5011\u9084\u53ef\u80fd\u60f3\u8981\u4e0a\u50b3\u6a94\u6848\u3001\u5716\u7247\u3001\u5f71\u7247\u5728\u8868\u55ae\u88e1\u982d\uff0c\u9019\u6a23\u7684\u9700\u6c42\u4fc3\u6210\u4e86 multipart/form-data \u898f\u7bc4\u7684\u51fa\u73fe"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u50b3\u905e\u65b9\u5f0f: POST \u65b9\u6cd5")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u8981\u4e0a\u50b3\u55ae\u500b\u6587\u4ef6\uff0c\u53ea\u9700\u5c07 FileInterceptor()\u6514\u622a\u5668\u7d81\u5b9a\u5230\u8def\u7531\u8655\u7406\u7a0b\u5e8f\u4e26 file \u5f9e requestusing@UploadedFile()\u88dd\u98fe\u5668\u4e2d\u63d0\u53d6\u3002"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { Body, Controller, Delete, Get, Param, Post,  UploadedFile, UseInterceptors, } from '@nestjs/common';\n@Post('upload')\n@UseInterceptors(FileInterceptor('file'))\nuploadFile(@UploadedFile() file: Express.Multer.File) {\n  console.log(file);\n}\n")),(0,r.kt)("p",null,"\u4f7f\u7528 postman\uff0c\u5728 body \u9801\u9078\u64c7 form-data\uff0c\u8f38\u5165 key \u7232 file\uff0c\u9078\u64c7\u4e00\u500b\u6a94\u6848\uff0c\u76f4\u63a5 sand \u5373\u53ef"),(0,r.kt)("p",null,"Q:ERROR ","[ExceptionsHandler]"," Multipart: Boundary not found\nA:\u4e0d\u9700\u8981\u91cd\u8907\u8a2d\u7f6e Content-Type: mutipart/form-data \u5426\u5247\u53ef\u80fd\u6703\u8986\u84cb\u539f\u6709\u7684\uff0c \u9020\u6210\u975e\u9810\u671f\u7684\u932f\u8aa4"),(0,r.kt)("h3",{id:"\u5c07-file-\u7684\u503c\u8b80\u51fa\u4f86"},"\u5c07 file \u7684\u503c\u8b80\u51fa\u4f86"),(0,r.kt)("p",null,"file.buffer \u662f\u6a94\u6848\u7684\u5167\u5bb9\u7684\u503c\uff0c\u578b\u614b\u7232 object\n\u5148\u8f49\u6210 string \u7684\u5f62\u614b\uff0c\u518d\u8f49\u6210 Json \u683c\u5f0f\u8b80\u51fa"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'const data = file.buffer;\nconsole.log(data);\nconsole.log(typeof data);\nconst data_string = data.toString();\nconsole.log(data_string);\nconsole.log(typeof data_string);\nconst data_json = JSON.parse(data_string);\nconsole.log(data_json);\nconsole.log(typeof data_json);\nconsole.log(data_json["username"]);\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"console.log(file)\n\n{ fieldname: 'file',\n  originalname: 'example.json',\n  encoding: '7bit',\n  mimetype: 'application/json',\n  buffer:\n   <Buffer 7b 0a 09 22 66 69 72 73 74 4e 61 6d 65 22 3a 20 22 61 61 72 6f 6e 22 2c 0a 09 22 6c 61 73 74 4e 61 6d 65 22 3a 20 22 63 68 61 6e 67 22 0a 7d 0a>,\n  size: 48 }\n")),(0,r.kt)("p",null,"\u9470\u5319 \u63cf\u8ff0 \u7b46\u8a18",(0,r.kt)("br",{parentName:"p"}),"\n","fieldname \u8868\u55ae\u4e2d\u6307\u5b9a\u7684\u5b57\u6bb5\u540d\u7a31",(0,r.kt)("br",{parentName:"p"}),"\n","originalname \u7528\u6236\u8a08\u7b97\u6a5f\u4e0a\u7684\u6587\u4ef6\u540d",(0,r.kt)("br",{parentName:"p"}),"\n","encoding \u6587\u4ef6\u7684\u7de8\u78bc\u985e\u578b",(0,r.kt)("br",{parentName:"p"}),"\n","mimetype \u6587\u4ef6\u7684 MIME \u985e\u578b",(0,r.kt)("br",{parentName:"p"}),"\n","size \u6587\u4ef6\u7684\u5927\u5c0f\uff08\u4ee5\u5b57\u7bc0\u70ba\u55ae\u4f4d\uff09",(0,r.kt)("br",{parentName:"p"}),"\n","destination \u4fdd\u5b58\u6587\u4ef6\u7684\u6587\u4ef6\u593e DiskStorage",(0,r.kt)("br",{parentName:"p"}),"\n","filename \u5167\u7684\u6587\u4ef6\u540d destination DiskStorage",(0,r.kt)("br",{parentName:"p"}),"\n","path \u4e0a\u50b3\u6587\u4ef6\u7684\u5b8c\u6574\u8def\u5f91 DiskStorage",(0,r.kt)("br",{parentName:"p"}),"\n","buffer ABuffer \u6574\u500b\u6587\u4ef6 MemoryStorage"),(0,r.kt)("h3",{id:"entity-\u7d00\u9304"},"@Entity \u7d00\u9304"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"@Entity()\u662f\u5c07\u8cc7\u6599\u8868\u5be6\u9ad4\u5316\u6210\u8cc7\u6599\u5eab\u7684 table"),(0,r.kt)("li",{parentName:"ul"},"@Entity('table_name') \u53ca @Entity({name:'table_name'})\u53ef\u4ee5\u547d\u540d table \u7684 name",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u82e5\u7559\u7a7a\u767d\uff0c\u662f\u4ee5 class name \u7576\u4f5c table name"),(0,r.kt)("li",{parentName:"ul"},"class name \u662f\u4ee5\u5927\u5beb\u7232\u5206\u9694","_","\uff0c\u3000 example: 'sceneScheduleEntity'\u5247\u70ba'scene_schedule_entity'")))),(0,r.kt)("h3",{id:"\u6a94\u6848\u547d\u540d\u898f\u5247"},"\u6a94\u6848\u547d\u540d\u898f\u5247"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"nestjs \u7684\u6a94\u540d\u901a\u5e38\u547d\u540d\u7232 filename.\u529f\u80fd.ts\uff0c example: archive.entity.ts")),(0,r.kt)("h3",{id:"import-service"},"Import service"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u82e5 A service \u8981 import B service \u9700\u8981\u505a\u4ee5\u4e0b\u6b65\u9a5f")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'\u5728 A service \u7684 constructor \u5be6\u9ad4\u5316\u7269\u4ef6 "private readonly logger: EmsLogger"'),(0,r.kt)("li",{parentName:"ol"},'\u5728 A module "imports:',"[B module]",'"'),(0,r.kt)("li",{parentName:"ol"},'\u5728 B module \u8f38\u51fa sevice "exports: ',"[B Service]",'"'),(0,r.kt)("li",{parentName:"ol"},"\u5b8c\u6210")),(0,r.kt)("h3",{id:"nestjs-\u6982\u5ff5"},"Nestjs \u6982\u5ff5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"main.ts -> app.module -> app.controller -> app.service\n")),(0,r.kt)("h3",{id:"\u7a0b\u5f0f\u9032\u5165\u9edemaints"},"\u7a0b\u5f0f\u9032\u5165\u9ede(main.ts)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"bootstarp() \u547c\u53eb function bootstarp()\u518d\u547c\u53eb function parseCli",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u82e5 state=cofig \u6703\u547c\u53eb function configApp()"),(0,r.kt)("li",{parentName:"ul"},"\u82e5 state=dcs \u6703\u547c\u53eb function DataCollectionApp()")))),(0,r.kt)("h3",{id:"\u91cd\u8dd1-migrations-\u7684\u65b9\u6cd5"},"\u91cd\u8dd1 migrations \u7684\u65b9\u6cd5"),(0,r.kt)("p",null,"migrations \u7684\u6982\u5ff5\u662f\uff0c\u6709\u8dd1\u904e\u7684\u6703\u8a18\u9304\u5728 migrations table\uff0c\u7576\u4e0b\u6b21\u7a0b\u5f0f\u904b\u884c\u7684\u6642\u5019\uff0c\u6703\u5148\u6aa2\u67e5\u6709\u6c92\u6709\u8dd1\u904e\uff0c\u82e5\u6709\u5c31\u4e0d\u6703\u5728\u8dd1\u4e86\uff0c\u6240\u4ee5\u8a18\u5f97\u8981\u780d\u7d00\u9304\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u780d\u7d00\u9304")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"select *  from `migrations`;\ndelete from `migrations` where id={id};\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u4fee\u6539 migrations \u6a94\u6848")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"   \u5efa\u7acb\u4e00\u500b\u65b0\u7684\u6a94\u6848\uff0c\u88e1\u9762\u8981\u6709 up \u548c down function\n   \u82e5\u662f\u4fee\u6539\u820a\u7684\u6a94\u6848\uff0c\u8981\u628a\u4e0d\u9700\u8981\u91cd\u8dd1\u7684\u5730\u65b9\u8a3b\u89e3\u6389\uff0c\u4e0d\u7136\u76f8\u540c\u7684\u8cc7\u6599\u6703\u91cd\u8907 insert\n")),(0,r.kt)("h3",{id:"class-validator"},"Class-validator"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Reference from ",(0,r.kt)("a",{parentName:"strong",href:"https://github.com/typestack/class-validator"},"https://github.com/typestack/class-validator"))),(0,r.kt)("h3",{id:"\u76ee\u7684"},"\u76ee\u7684"),(0,r.kt)("p",null,"\u5229\u7528 DTO \u6aa2\u67e5\u8f38\u5165\u7684\u8cc7\u6599\u683c\u5f0f\uff0c\u662f\u5426\u7b26\u5408\u9810\u671f\u3002"),(0,r.kt)("h3",{id:"install-class-validator"},"Install class-validator"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm i --save class-validator class-transformer\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'\u67e5\u8a62\u7248\u672c\nnest -v #7.6.0\n\n\u5efa\u7acb\u65b0\u7684\u5c08\u6848\nnest new learn_nest\n\n\u57f7\u884c\u5c08\u6848\nnpm run start\nnpm run start:dev //\u9032\u5165\u958b\u767c\u8005\u6a21\u5f0f\uff0c\u9805\u76ee\u6587\u4ef6\u6709\u4fee\u6539\u6703\u81ea\u52d5\u91cd\u958b\n\n\n\u5efa\u7acbController\nnest g controller cats\nnest g co cats             //\u53ef\u4ee5\u7e2e\u5beb\n\n\u5efa\u7acbModule cats\nnest g mo cats\n\n\n\u5efa\u7acb CRUD \u751f\u6210\u5668\nnest g resource [name]\n\n\n\u6a94\u6848    \u8aaa\u660e\napp.controller.spec.ts    //\u91dd\u5c0d\u63a7\u5236\u5668\u7684\u55ae\u5143\u6e2c\u8a66\napp.controller.ts         //\u5e36\u6709\u55ae\u500b\u8def\u7531\u7684\u57fa\u672c\u63a7\u5236\u5668\napp.module.ts             //\u61c9\u7528\u7a0b\u5f0f\u7684\u6839\u6a21\u7d44\uff08root module\uff09\napp.service.ts            //\u5177\u6709\u55ae\u4e00\u65b9\u6cd5\u7684\u57fa\u672c\u670d\u52d9\uff08service\uff09\nmain.ts                   //\u61c9\u7528\u7a0b\u5f0f\u7684\u5165\u53e3\u6a94\u6848\uff0c\u5b83\u4f7f\u7528\u6838\u5fc3\u51fd\u5f0f NestFactory \u4f86\u5efa\u7acb Nest \u61c9\u7528\u7a0b\u5f0f\u7684\u4f8b\u9805\u6838\u5fc3\n\nNest.js \u7684\u57fa\u672c\u67b6\u69cb\u4e3b\u8981\u5206\u70ba\uff1a\nMain (\u4e3b\u7a0b\u5f0f\u7684\u9032\u5165\u9ede)\nModule (\nController\nService\nController\n\u63a7\u5236\u5668\uff0c\u5f9e Module \u88ab\u547c\u53eb\uff0c\u4e26\u64c1\u6709\u57fa\u672c\u8def\u7531\u8a2d\u5b9a\uff0c\u4e3b\u8981\u8ca0\u8cac\u63a5\u6536 client \u7aef\u7684 requests \u4ee5\u53ca response\u3002\n\u900f\u904e @Controller \u53ef\u4ee5\u5b9a\u7fa9\u6b64\u6a94\u6848\u70ba Controller@Injectable() \u5b9a\u7fa9\u6b64\u985e\u5225\u70ba service\n\n\n\n\n\n\u5b89\u88ddtpye-orm\u548cmysql\u5957\u4ef6\ncd project\nnpm install --save @nestjs/typeorm typeorm mysql   // typeorm:0.2.32  mysql:2.18.1\n\n\n\u53ef\u4ee5\u4e0d\u7528\u547c\u53ebService\u4e5f\u53ef\u4ee5\u505a\u52d5\n  @Get()\n  // getHello(){\n  //   return this.appService.getHello();\n  // }\n  index() {\n    return "aaron is good";\n  }\n\n\u547c\u53eb\u8aaa\u660e\nnest -h\n\n\u9084\u4e0d\u592a\u61c2create\u7684\u7528\u6cd5\n    @Post()\n    create() {\n        return {\n            success: 1\n        }\n    }\n\n\u5fc3\u5f97\nmodule\u7684\u5efa\u7acb\uff0c\u5c31\u50cf\u5806\u7a4d\u6728\u4e00\u6a23\n\n\n\n\n\u82e5\u589e\u52a0Module\uff0c\u8981\u5728app.modules.ts\u8981\u52a0\u4e0aimport: [\u65b0\u7684Module]\n\u82e5\u589e\u52a0Controller\uff0c\u8981\u5728\u65b0\u7684\u7684Module.ts\u5167\u52a0\u4e0acontrollers:[\u65b0\u7684Controller]\n\u82e5\u589e\u52a0Service\uff0c\u8981\u5728\u65b0\u7684Module.ts\u5167\u52a0\u4e0aproviders:[\u65b0\u7684Service]\n\n\u82e5\u6709$id\u8981\u66ff\u63db\u7684 \u8981\u4f7f\u7528\u2035`\n\n@Post\n@Body() { message}\n\u8acb\u4f7f\u7528postman \u6253\u958b body/\u9078\u64c7raw/\u9078\u64c7json\n\u63a5\u8457\u8f38\u5165\n{\n    "message": "hello"\n}\n\u5c31\u6703\u8f38\u51fahello\n\n@Query {id}    => localhost:3000?id=1\n@Body {message } => body\u5167\u7684JSON\n@Param {id}   =>  localhost:3000/hello/1\n')))}m.isMDXComponent=!0}}]);